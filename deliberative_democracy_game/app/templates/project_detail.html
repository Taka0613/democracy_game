{% extends "base.html" %}
{% block title %}Project Detail{% endblock %}
{% block content %}
<h2>{{ project.name }}</h2>
<p><strong>Description:</strong> {{ project.description }}</p>
<p><strong>Required Resources:</strong> {{ project.required_resources }}</p>
<p><strong>Outcomes:</strong> {{ project.outcomes }}</p>

<form method="POST">
    <h3>Contribute Resources</h3>
    {% for user in users %}
    <div>
        <h4>{{ user.character_name }}</h4>
        <p><strong>Current Resources:</strong></p>
        <ul>
            {% set user_resources = user.resources|groupby('type') %}
            {% for resource_type, resources in user_resources %}
            <li>{{ resource_type }}: {{ resources[0].amount }}</li>
            {% endfor %}
        </ul>

        <!-- Contribution Input Fields -->
        <label>Contribute Labor (Max {{ user.resources | selectattr('type', 'equalto', 'Labor') |
            map(attribute='amount') | sum }}):</label>
        <input type="number" name="contribute_labor_{{ user.id }}" min="0" value="0"><br>

        <label>Contribute Money (Max {{ user.resources | selectattr('type', 'equalto', 'Money') |
            map(attribute='amount') | sum }}):</label>
        <input type="number" name="contribute_money_{{ user.id }}" min="0" value="0"><br>

        <label>Contribute Time (Max {{ user.resources | selectattr('type', 'equalto', 'Time') |
            map(attribute='amount') | sum }}):</label>
        <input type="number" name="contribute_time_{{ user.id }}" min="0" value="0"><br>

        <!-- Insights Input Field -->
        <label>Policy Insight/Feedback:</label><br>
        <textarea name="policy_insight_{{ user.id }}" rows="4" cols="50"
            placeholder="Write your insights or suggested modifications about the policy..."></textarea><br>
    </div>
    {% endfor %}
    <button type="submit">Submit Contribution and Feedback</button>
</form>
{% endblock %}